<%- include('../partials/head', { title }) %>
<%- include('../partials/nav') %>
<main class="mx-auto max-w-6xl px-6 py-12">
  <div class="flex items-center justify-between">
    <div>
      <p class="text-sm uppercase tracking-[0.3em] text-indigo-500">Admin panel</p>
      <h1 class="mt-2 text-3xl font-semibold">Service status management</h1>
    </div>
    <div class="flex gap-2">
      <a class="rounded-full border border-slate-200 px-4 py-2 text-sm font-medium" href="/admin/announcements">Announcements</a>
      <a class="rounded-full border border-slate-200 px-4 py-2 text-sm font-medium" href="/admin/openapi">OpenAPI Spec</a>
    </div>
  </div>

  <div class="mt-6">
    <%- include('../partials/flash') %>
  </div>

  <div class="mt-8 grid gap-6 lg:grid-cols-[1fr_2fr]">
    <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
      <h2 class="text-lg font-semibold">Add new service</h2>
      <form class="mt-4 flex flex-col gap-3" action="/admin/services" method="POST">
        <input class="rounded-xl border border-slate-200 px-4 py-2" name="name" placeholder="Service name" required />
        <input class="rounded-xl border border-slate-200 px-4 py-2" name="description" placeholder="Short description" />
        <input class="rounded-xl border border-slate-200 px-4 py-2" name="category" placeholder="Category (API, Database, Web...)" />
        <select class="rounded-xl border border-slate-200 px-4 py-2" name="status" required>
          <option value="OPERATIONAL">Operational</option>
          <option value="DEGRADED">Degraded</option>
          <option value="PARTIAL_OUTAGE">Partial outage</option>
          <option value="MAJOR_OUTAGE">Major outage</option>
          <option value="MAINTENANCE">Maintenance</option>
        </select>
        <label class="flex items-center gap-2 text-sm text-slate-600">
          <input type="checkbox" name="isActive" checked />
          Active
        </label>
        <button class="rounded-xl bg-indigo-600 px-4 py-2 font-medium text-white hover:bg-indigo-500" type="submit">
          Create service
        </button>
      </form>
    </section>

    <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
      <h2 class="text-lg font-semibold">Existing services</h2>
      <div class="mt-4 flex flex-col gap-4">
        <% if (!services.length) { %>
          <p class="text-slate-500">No services yet. Add one to start tracking status.</p>
        <% } %>
        <% services.forEach((service) => { %>
          <form class="rounded-2xl border border-slate-200 bg-slate-50 p-4" action="/admin/services/<%= service.id %>" method="POST">
            <div class="grid gap-3 md:grid-cols-2">
              <input class="rounded-xl border border-slate-200 px-4 py-2" name="name" value="<%= service.name %>" required />
              <input class="rounded-xl border border-slate-200 px-4 py-2" name="category" value="<%= service.category || '' %>" placeholder="Category" />
              <input class="rounded-xl border border-slate-200 px-4 py-2 md:col-span-2" name="description" value="<%= service.description || '' %>" placeholder="Description" />
              <select class="rounded-xl border border-slate-200 px-4 py-2" name="status" required>
                <% ['OPERATIONAL','DEGRADED','PARTIAL_OUTAGE','MAJOR_OUTAGE','MAINTENANCE'].forEach((option) => { %>
                  <option value="<%= option %>" <%= service.status === option ? 'selected' : '' %>>
                    <%= statusLabels[option] %>
                  </option>
                <% }) %>
              </select>
              <label class="flex items-center gap-2 text-sm text-slate-600">
                <input type="checkbox" name="isActive" <%= service.isActive ? 'checked' : '' %> />
                Active
              </label>
            </div>
            <div class="mt-4 flex flex-wrap gap-3">
              <button class="rounded-full bg-slate-900 px-4 py-2 text-sm font-medium text-white" type="submit">
                Save changes
              </button>
              <button
                class="rounded-full border border-rose-200 bg-rose-50 px-4 py-2 text-sm font-medium text-rose-700"
                type="submit"
                formmethod="POST"
                formaction="/admin/services/<%= service.id %>/delete"
              >
                Delete
              </button>
              <span class="ml-auto text-xs text-slate-400">
                Updated <%= service.updatedAt.toLocaleString() %>
              </span>
            </div>
          </form>
        <% }) %>
      </div>
    </section>
  </div>
</main>
<%- include('../partials/footer') %>
